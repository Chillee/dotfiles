#! /bin/sh
rank=$(curl 'http://celebratemydrive.com/Leaderboard.aspx' -H 'Accept-Encoding: gzip,deflate,sdch' -H 'Host: celebratemydrive.com' -H 'Accept-Language: en-US,en;q=0.8' -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/30.0.1599.101 Safari/537.36' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8' -H 'Referer: http://celebratemydrive.com/' -H 'Cookie: ASP.NET_SessionId=wjtdyfifwcmtuewt533fh4ue; CMD2013=fromEmail=nugget@crappers.info&ageID=1&affil=student&zip=&birthDate=1995/11/11&canada=False&itemID=&AnswerQ1=A&AnswerQ2=D&AnswerQ1Desc=A is the way! Actively scanning the road ahead can help you identify and respond to hazards in time.&AnswerQ2Desc=The answer is D. Scanning is a method of keeping your eyes constantly moving in order to notice potential problems.&Q1=False&Q2=True; __utma=105602449.1855410466.1382372721.1382556361.1382626313.4; __utmb=105602449.6.9.1382626358287; __utmc=105602449; __utmz=105602449.1382372721.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)' -H 'Connection: keep-alive' -H 'Cache-Control: max-age=0' --compressed | grep -i -B3 'pennridge high school' | grep -i 'fulllargeleaderboard_lblRank' | cut -d\> -f4 | cut -d\< -f1)
rankstore='/dev/shm/celrank'
lastrank="$(cat $rankstore)" 

function rankstat() {
if [[ "$lastrank" != "$rank" ]]; then
	echo 'Rank changed!'
	echo "At: $(date)"
	echo "Current: $rank"
	echo "Delta: $[$rank-$lastrank]"
	echo
fi
}

ranklog='/dev/shm/ranklog'
rankstat | tee -a "$ranklog"
echo $rank > $rankstore
